<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Export Excel Test</title>
  <script src="https://unpkg.com/xlsx-style@0.8.13/dist/xlsx.full.min.js"></script>
</head>
<body>
  <h2>Export Excel Demo</h2>
  <table id="attendanceTable" border="1">
    <thead>
      <tr>
        <th>Time</th>
        <th>01/04</th>
        <th>02/04</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>8h</td>
        <td>10</td>
        <td>12</td>
      </tr>
      <tr>
        <td>9h</td>
        <td>9</td>
        <td>11</td>
      </tr>
    </tbody>
  </table>

  <br />
  <button onclick="exportExcel()">Export Excel</button>

  <script>
    function exportExcel() {
      const wb = XLSX.utils.book_new();
      const ws_data = [];

      const table = document.getElementById('attendanceTable');
      const rows = table.querySelectorAll('tr');

      rows.forEach(row => {
        const rowData = [];
        row.querySelectorAll('th, td').forEach(cell => {
          rowData.push(cell.innerText.trim());
        });
        ws_data.push(rowData);
      });

      const ws = XLSX.utils.aoa_to_sheet(ws_data);

      const range = XLSX.utils.decode_range(ws['!ref']);
      for (let R = range.s.r; R <= range.e.r; ++R) {
        for (let C = range.s.c; C <= range.e.c; ++C) {
          const cellRef = XLSX.utils.encode_cell({ r: R, c: C });
          if (!ws[cellRef]) continue;
          ws[cellRef].s = {
            font: { bold: R === 0 },
            fill: R === 0 ? { fgColor: { rgb: "FFF9C4" } } : undefined,
            border: {
              top: { style: 'thin', color: { rgb: "000000" } },
              bottom: { style: 'thin', color: { rgb: "000000" } },
              left: { style: 'thin', color: { rgb: "000000" } },
              right: { style: 'thin', color: { rgb: "000000" } }
            }
          };
        }
      }

      // Auto column width
      ws['!cols'] = ws_data[0].map((_, i) => {
        const maxLen = ws_data.reduce((max, row) => {
          return Math.max(max, (row[i] || '').length);
        }, 10);
        return { wch: maxLen + 2 };
      });

      XLSX.utils.book_append_sheet(wb, ws, "Attendance");
      XLSX.writeFile(wb, "attendance.xlsx");
    }
  </script>
</body>
</html>
